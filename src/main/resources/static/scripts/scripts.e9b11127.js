"use strict";angular.module("search-of-the-fallen",["ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("search-of-the-fallen").controller("MainCtrl",["$scope","$http","$sce",function(a,b,c){a.rowOptions=[10,25,50,100],a.showResults=!1,a.rows=10,a.start=0,a.numFound=0,a.pages=0,a.currentPage=1,a.getStructure=function(){b.get("/api/info/novelStructure").then(function(b){a.novels=b.data})},a.getStructure(),a.generateDropdown=function(a){var b=[];return a?(a.books.forEach(function(a){if(0===a.number||100===a.number||101===a.number){var c={title:a.title,value:a.number,disabled:!1};b.push(c)}else{var d={title:"-"+a.title+"-",value:null,disabled:!0};b.push(d);for(var e=a.start;e<=a.end;e++){var f={title:"Chapter "+e,value:e,disabled:!1};b.push(f)}}}),b):b},a.$watch("selectedNovel",function(b){a.bookDropdown=a.generateDropdown(b),a.selectedChapter=""}),a.highlight=function(b){if(void 0===a.text||null===a.text||""===a.text)return b;var d=a.text.split(" "),e="("+d.join("|")+")";return c.trustAsHtml("<p>"+b.replace(new RegExp(e,"gi"),function(a){return"<mark>"+a+"</mark>"})+"</p>")},a.newSearch=function(){a.start=0,a.numFound=0,a.pages=0,a.currentPage=1,a.search()},a.search=function(){var c=a.upTo?"/api/search/upTo":"/api/search";b.get(c,{params:{text:a.text,novel:a.selectedNovel.order,chapter:a.selectedChapter,rows:a.rows,start:a.start}}).then(function(b){var c=b.data;console.log("in success"),a.numFound=c.numFound,a.rows=c.rows,a.start=c.start,a.results=c.searchResults,a.pages=Math.ceil(a.numFound/a.rows),a.showResults=!0})},a.resolveNovel=function(b){return 0===b||100===b||101===b?"":a.novels.find(function(a){return a.order===b}).name},a.resolveChapter=function(a){return 0===a?"Prologue":100===a?"Epilogue":101===a?"Epilogue II":"Chapter "+a},a.nextPage=function(){console.log("in nextPage"),a.start=a.start+a.rows,a.currentPage++,a.search()},a.prevPage=function(){console.log("in prevPage"),a.start=a.start-a.rows,a.start<0&&(a.start=0),a.currentPage--,a.search()}}]),angular.module("search-of-the-fallen").controller("AboutCtrl",function(){});